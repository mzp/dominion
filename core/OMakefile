.PHONY: all clean

USE_OCAMLFIND = true

OCAMLPACKS[] =
	extlib
	oUnit
	threads
	ccell
	str
	curses
	xml-light

if $(not $(OCAMLFIND_EXISTS))
    eprintln("This project requires ocamlfind, but is was not found.")
    eprintln(You need to install ocamlfind and run "omake --configure".)
    exit 1

OCAMLC=ocamlc -thread

NATIVE_ENABLED=false
BYTE_ENABLED = true
FILES[] =
	observer
	base
	hList
	game
	cc
	server
	client
	socket
	logger
	protocol
	maybe
	handler
	threadUtils
	handlerBase
	commonHandler
	readyHandler
	playerHandler
	listUtil
	contHandler
	rule
	shell
	turn
	actionCard
	cardSource
	fiber

OUNIT_LIBS[] =
	oUnitUtil
	base
	hList
	listUtil

UseCamlp4(pa_monad)
OUnitTest(playerHandler, playerHandler contHandler cc logger game handlerBase maybe rule observer)
OUnitTest(commonHandler, commonHandler maybe game handlerBase)
OUnitTest(readyHandler , readyHandler maybe game handlerBase)
OUnitTest(contHandler  , contHandler cc hList)
OUnitTest(game, game)
OUnitTest(rule, rule game cc )
OUnitTest(observer, observer)


OCAMLFLAGS=-annot -w A -warn-error A
PROGRAM = dominion
# OCAML_LIBS +=
# OCAML_CLIBS +=
# OCAML_OTHER_LIBS +=
# OCAML_LIB_FLAGS +=
#
.DEFAULT: $(PROGRAM)

OCamlProgram($(PROGRAM), main $(FILES))

clean:
	$(RM) *.cm[iox] *.o $(PROGRAM) *.opt *-runner *.run *.annot
