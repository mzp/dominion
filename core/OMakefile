.PHONY: all clean

USE_OCAMLFIND = true

OCAMLPACKS[] =
	extlib
	oUnit
	threads
	ccell
	str


if $(not $(OCAMLFIND_EXISTS))
    eprintln("This project requires ocamlfind, but is was not found.")
    eprintln(You need to install ocamlfind and run "omake --configure".)
    exit 1

OCAMLC=ocamlc -thread

NATIVE_ENABLED=false
BYTE_ENABLED = true
FILES[] =
	base
	hList
	game
	cc
	server
	client
	socket
	logger
	protocol
	maybe
	handler
	threadUtils
	handlerBase
	commonHandler
	readyHandler
	playerHandler
	listUtil
	contHandler
	rule

UseCamlp4(pa_monad)
OUnitTest(playerHandler, playerHandler contHandler cc base logger game hList listUtil handlerBase maybe rule)
OUnitTest(commonHandler, commonHandler base maybe game handlerBase listUtil hList)
OUnitTest(readyHandler , readyHandler base maybe game handlerBase listUtil hList)
OUnitTest(contHandler  , contHandler base cc hList)
OUnitTest(game, game base hList)
OUnitTest(rule, rule game base cc hList listUtil)
OUnitTest(observer, observer base)

OCAMLFLAGS=-annot -w A -warn-error A
PROGRAM = dominion
# OCAML_LIBS +=
# OCAML_CLIBS +=
# OCAML_OTHER_LIBS +=
# OCAML_LIB_FLAGS +=
#
.DEFAULT: $(PROGRAM)

OCamlProgram($(PROGRAM), main $(FILES))

clean:
	$(RM) *.cm[iox] *.o $(PROGRAM) *.opt *-runner *.run *.annot
